<div class="jours-feries-container">
  <!-- En-tête -->
  <div class="page-header mb-4">
    <div class="d-flex flex-column">
      <div class="text-center mb-3">
        <h2 class="page-title">
          <i class="bi bi-calendar-event me-2 text-primary"></i>
          Gestion des Jours Fériés
        </h2>
        <p class="page-subtitle text-muted mb-0">
          Configuration des jours fériés de votre entreprise
        </p>
      </div>
      <div class="d-flex justify-content-end gap-2">
        <button
          class="btn btn-outline-primary"
          (click)="refresh()"
          [disabled]="isLoading">
          <i class="bi bi-arrow-clockwise me-1"></i>
          Actualiser
        </button>
        <button
          class="btn btn-primary"
          (click)="ouvrirModalAjout()"
          [disabled]="isLoading">
          <i class="bi bi-plus-lg me-1"></i>
          Ajouter un jour férié
        </button>
      </div>
    </div>
  </div>

  <!-- Statistiques - Placées ici, après l'en-tête et avant les filtres -->
  <div class="row g-3 mb-4" *ngIf="!isLoading && !error">
    <div class="col-md-3">
      <div class="card border-primary stats-card">
        <div class="card-body text-center bg-primary bg-opacity-10">
          <h3 class="stats-number text-primary">{{ getTotalJoursFeries() }}</h3>
          <p class="stats-label text-primary">Total Jours Fériés</p>
        </div>
      </div>
    </div>

    <div class="col-md-3">
      <div class="card border-success stats-card">
        <div class="card-body text-center bg-success bg-opacity-10">
          <h3 class="stats-number text-success">{{ getJoursFeriesParType('paye') }}</h3>
          <p class="stats-label text-success">Jours Payés</p>
        </div>
      </div>
    </div>

    <div class="col-md-3">
      <div class="card border-warning stats-card">
        <div class="card-body text-center bg-warning bg-opacity-10">
          <h3 class="stats-number text-warning">{{ getJoursFeriesParType('non-paye') }}</h3>
          <p class="stats-label text-warning">Jours Non Payés</p>
        </div>
      </div>
    </div>

    <div class="col-md-3">
      <div class="card border-info stats-card">
        <div class="card-body text-center bg-info bg-opacity-10">
          <h3 class="stats-number text-info">{{ getJoursFeriesRestants() }}</h3>
          <p class="stats-label text-info">Jours Restants</p>
        </div>
      </div>
    </div>
  </div>

  <!-- Filtres -->
  <div class="card shadow-sm mb-4">
    <div class="card-header bg-light">
      <h6 class="card-title mb-0">
        <i class="bi bi-funnel me-2"></i>
        Filtres et recherche
      </h6>
    </div>
    <div class="card-body">
      <div class="row g-3">
        <!-- Recherche -->
        <div class="col-md-4">
          <label class="form-label fw-medium">
            <i class="bi bi-search me-1"></i>
            Rechercher
          </label>
          <div class="input-group">
            <span class="input-group-text bg-white border-end-0">
              <i class="bi bi-search text-muted"></i>
            </span>
            <input
              type="text"
              class="form-control border-start-0"
              placeholder="Nom ou date..."
              [(ngModel)]="searchTerm"
              (input)="applyFilters()" />
          </div>
        </div>

        <!-- Filtre année -->
        <div class="col-md-2">
          <label class="form-label fw-medium">
            <i class="bi bi-calendar3 me-1"></i>
            Année
          </label>
          <select class="form-select" [(ngModel)]="filterAnnee" (change)="applyFilters()">
            <option value="toutes">Toutes</option>
            <option *ngFor="let annee of getAnneesDisponibles()" [value]="annee">
              {{ annee }}
            </option>
          </select>
        </div>

        <!-- Filtre type -->
        <div class="col-md-2">
          <label class="form-label fw-medium">
            <i class="bi bi-tags me-1"></i>
            Type
          </label>
          <select class="form-select" [(ngModel)]="filterType" (change)="applyFilters()">
            <option value="tous">Tous</option>
            <option value="paye">Payés</option>
            <option value="non-paye">Non payés</option>
          </select>
        </div>

        <!-- Items par page -->
        <div class="col-md-2">
          <label class="form-label fw-medium">Affichage</label>
          <select class="form-select" [(ngModel)]="itemsPerPage" (change)="applyFilters()">
            <option value="5">5 par page</option>
            <option value="10">10 par page</option>
            <option value="25">25 par page</option>
          </select>
        </div>

        <!-- Reset -->
        <div class="col-md-2 d-flex align-items-end">
          <button class="btn btn-outline-secondary w-100" (click)="resetFilters()">
            <i class="bi bi-arrow-counterclockwise me-1"></i>
            Reset
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- Tableau -->
  <div class="card shadow-sm">
    <div class="card-header bg-white d-flex justify-content-between align-items-center">
      <h6 class="card-title mb-0">
        <i class="bi bi-table me-2"></i>
        Liste des jours fériés ({{ totalItems }} jour{{ totalItems > 1 ? 's' : '' }})
      </h6>
    </div>

    <div class="card-body p-0">
      <!-- État de chargement -->
      <div *ngIf="isLoading" class="loading-container">
        <div class="loading-content">
          <div class="spinner-border text-primary" role="status">
            <span class="visually-hidden">Chargement...</span>
          </div>
          <p class="mt-3 text-muted">Chargement des jours fériés...</p>
        </div>
      </div>

      <!-- État d'erreur -->
      <div *ngIf="error && !isLoading" class="alert alert-danger m-3" role="alert">
        <div class="d-flex align-items-center">
          <i class="bi bi-exclamation-triangle-fill me-2 fs-4"></i>
          <div class="flex-grow-1">
            <h6 class="alert-heading mb-1">Erreur de chargement</h6>
            <p class="mb-2">{{ error }}</p>
            <button class="btn btn-outline-danger btn-sm" (click)="refresh()">
              <i class="bi bi-arrow-clockwise me-1"></i>
              Réessayer
            </button>
          </div>
        </div>
      </div>

      <!-- Tableau des données -->
      <div *ngIf="!isLoading && !error" class="table-responsive">
        <table class="table table-hover align-middle mb-0">
          <thead class="table-light sticky-top">
            <tr>
              <!-- Date -->
              <th scope="col" class="border-0 ps-3 sortable" (click)="sort('dateFerie')">
                <div class="d-flex align-items-center">
                  <i class="bi bi-calendar-event me-2 text-primary"></i>
                  Date
                  <i class="bi ms-1" [ngClass]="{
                    'bi-arrow-up': sortBy === 'dateFerie' && sortDirection === 'asc',
                    'bi-arrow-down': sortBy === 'dateFerie' && sortDirection === 'desc',
                    'bi-arrow-up-down': sortBy !== 'dateFerie'
                  }"></i>
                </div>
              </th>

              <!-- Nom -->
              <th scope="col" class="border-0 sortable" (click)="sort('nom')">
                <div class="d-flex align-items-center">
                  <i class="bi bi-type me-2 text-primary"></i>
                  Nom
                  <i class="bi ms-1" [ngClass]="{
                    'bi-arrow-up': sortBy === 'nom' && sortDirection === 'asc',
                    'bi-arrow-down': sortBy === 'nom' && sortDirection === 'desc',
                    'bi-arrow-up-down': sortBy !== 'nom'
                  }"></i>
                </div>
              </th>

              <!-- Type -->
              <th scope="col" class="border-0 text-center">
                <i class="bi bi-info-circle me-1 text-primary"></i>
                Statut
              </th>

              <!-- Actions -->
              <th scope="col" class="border-0 text-center pe-3">
                <i class="bi bi-gear me-1"></i>
                Actions
              </th>
            </tr>
          </thead>

          <tbody>
            <tr *ngFor="let jourFerie of getPaginatedItems(); let i = index" class="table-row">

              <!-- Date -->
              <td class="ps-3">
                <div class="date-info">
                  <div class="date-badge" [class]="isDateInFuture(jourFerie.dateFerie) ? 'future-date' : 'past-date'">
                    <div class="date-day">{{ formatDateShort(jourFerie.dateFerie).split('/')[0] }}</div>
                    <div class="date-month-year">
                      {{ formatDateShort(jourFerie.dateFerie).split('/')[1] }}/{{ formatDateShort(jourFerie.dateFerie).split('/')[2] }}
                    </div>
                  </div>
                  <div class="date-full ms-3">
                    <div class="fw-medium">{{ formatDate(jourFerie.dateFerie) }}</div>
                    <small class="text-muted" *ngIf="isDateInFuture(jourFerie.dateFerie)">
                      <i class="bi bi-clock me-1"></i>À venir
                    </small>
                    <small class="text-muted" *ngIf="!isDateInFuture(jourFerie.dateFerie)">
                      <i class="bi bi-check me-1"></i>Passé
                    </small>
                  </div>
                </div>
              </td>

              <!-- Nom -->
              <td>
                <div class="nom-info">
                  <div class="fw-medium">{{ jourFerie.nom }}</div>
                  <small class="text-muted">Jour férié</small>
                </div>
              </td>

              <!-- Statut -->
              <td class="text-center">
                <span [class]="getStatusBadgeClass(jourFerie.estChomeEtPaye)">
                  <i class="bi me-1" ></i>
                  {{ getStatusText(jourFerie.estChomeEtPaye) }}
                </span>
              </td>

              <!-- Actions -->
              <td class="text-center pe-3">
                <div class="btn-group action-buttons" role="group">
                  <button
                    class="btn btn-outline-warning btn-sm"
                    (click)="ouvrirModalModification(jourFerie)"
                    title="Modifier">
                    Modifier
                  </button>
                  <button
                    class="btn btn-outline-danger btn-sm"
                    (click)="ouvrirModalSuppression(jourFerie)"
                         title="Supprimer">
                    Supprimer
                  </button>
                </div>
              </td>
            </tr>

            <!-- Aucun résultat -->
            <tr *ngIf="getPaginatedItems().length === 0">
              <td colspan="4" class="text-center py-5">
                <div class="empty-state">
                  <i class="bi bi-calendar-x empty-icon"></i>
                  <h6 class="empty-title">Aucun jour férié trouvé</h6>
                  <p class="empty-description text-muted">
                    Aucun jour férié ne correspond aux critères de recherche.
                  </p>
                  <button class="btn btn-primary btn-sm" (click)="ouvrirModalAjout()">
                    <i class="bi bi-plus-lg me-1"></i>
                    Ajouter le premier jour férié
                  </button>
                </div>
              </td>
            </tr>
          </tbody>
        </table>
      </div>

      <!-- Pagination -->
      <div class="card-footer bg-white" *ngIf="getTotalPages() > 1">
        <div class="d-flex justify-content-between align-items-center">
          <div class="text-muted">
            <small>
              Affichage de {{ (currentPage - 1) * itemsPerPage + 1 }} à
              {{ getMin(currentPage * itemsPerPage, totalItems) }} sur {{ totalItems }} jour(s)
            </small>
          </div>

          <nav aria-label="Navigation des pages">
            <ul class="pagination pagination-sm mb-0">
              <li class="page-item" [class.disabled]="currentPage === 1">
                <button class="page-link" (click)="goToPage(currentPage - 1)">
                  <i class="bi bi-chevron-left"></i>
                </button>
              </li>

              <li class="page-item"
                  *ngFor="let page of [].constructor(getTotalPages()); let i = index"
                  [class.active]="currentPage === i + 1">
                <button class="page-link" (click)="goToPage(i + 1)">
                  {{ i + 1 }}
                </button>
              </li>

              <li class="page-item" [class.disabled]="currentPage === getTotalPages()">
                <button class="page-link" (click)="goToPage(currentPage + 1)">
                  <i class="bi bi-chevron-right"></i>
                </button>
              </li>
            </ul>
          </nav>
        </div>
      </div>
    </div>
  </div>
</div>



<!-- Modal d'ajout/modification -->
<div class="modal fade" [class.show]="showModal" [style.display]="showModal ? 'block' : 'none'"
     tabindex="-1" *ngIf="showModal">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header" [class]="isEditMode ? 'bg-warning text-dark' : 'bg-primary text-white'">
        <h5 class="modal-title">
          <i class="bi me-2" [class]="isEditMode ? 'bi-pencil' : 'bi-plus-circle'"></i>
          {{ isEditMode ? 'Modifier le jour férié' : 'Ajouter un jour férié' }}
        </h5>
        <button type="button" class="btn-close" [class]="isEditMode ? '' : 'btn-close-white'" (click)="fermerModal()"></button>
      </div>

      <form [formGroup]="jourFerieForm" (ngSubmit)="onSubmit()">
        <div class="modal-body">

          <!-- Nom -->
          <div class="form-group mb-3">
            <label for="nom" class="form-label">
              <i class="bi bi-type text-primary me-1"></i>
              Nom du jour férié <span class="text-danger">*</span>
            </label>
            <input
              type="text"
              id="nom"
              class="form-control"
              formControlName="nom"
              [class.is-invalid]="isFieldInvalid('nom')"
              placeholder="Ex: Noël, Jour de l'An...">
            <div class="invalid-feedback" *ngIf="isFieldInvalid('nom')">
              {{ getFieldError('nom') }}
            </div>
          </div>

          <!-- Date -->
          <div class="form-group mb-3">
            <label for="dateFerie" class="form-label">
              <i class="bi bi-calendar-event text-primary me-1"></i>
              Date <span class="text-danger">*</span>
            </label>
            <input
              type="date"
              id="dateFerie"
              class="form-control"
              formControlName="dateFerie"
              [class.is-invalid]="isFieldInvalid('dateFerie')">
            <div class="invalid-feedback" *ngIf="isFieldInvalid('dateFerie')">
              {{ getFieldError('dateFerie') }}
            </div>
          </div>

          <!-- Statut payé -->
          <div class="form-group mb-3">
            <label class="form-label">
              <i class="bi bi-wallet2 text-primary me-1"></i>
              Statut de rémunération <span class="text-danger">*</span>
            </label>
            <div class="form-check">
              <input
                class="form-check-input"
                type="radio"
                name="estChomeEtPaye"
                id="estPayeOui"
                formControlName="estChomeEtPaye"
                [value]="true">
              <label class="form-check-label" for="estPayeOui">
                <i class="bi bi-check-circle text-success me-1"></i>
                Chômé et payé
              </label>
            </div>
            <div class="form-check">
              <input
                class="form-check-input"
                type="radio"
                name="estChomeEtPaye"
                id="estPayeNon"
                formControlName="estChomeEtPaye"
                [value]="false">
              <label class="form-check-label" for="estPayeNon">
                <i class="bi bi-exclamation-triangle text-warning me-1"></i>
                Chômé non payé
              </label>
            </div>
          </div>

        </div>



        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" (click)="fermerModal()">
            <i class="bi bi-x-circle me-1"></i>
            Annuler
          </button>
          <button
            type="submit"
            class="btn"
            [class]="isEditMode ? 'btn-warning' : 'btn-primary'"
            [disabled]="jourFerieForm.invalid || isSubmitting">
            <span *ngIf="isSubmitting" class="spinner-border spinner-border-sm me-2" role="status"></span>
            <i *ngIf="!isSubmitting" class="bi me-1" [class]="isEditMode ? 'bi-pencil' : 'bi-check-circle'"></i>
            <span *ngIf="isSubmitting">{{ isEditMode ? 'Modification...' : 'Ajout...' }}</span>
            <span *ngIf="!isSubmitting">{{ isEditMode ? 'Modifier' : 'Ajouter' }}</span>
          </button>
        </div>
      </form>
    </div>
  </div>
</div>

<div class="modal fade" [class.show]="showDeleteModal" [style.display]="showDeleteModal ? 'block' : 'none'"
     tabindex="-1" *ngIf="showDeleteModal">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content border-danger">
      <div class="modal-header bg-danger text-white">
        <h5 class="modal-title">
          <i class="bi bi-exclamation-triangle-fill me-2"></i>
          Confirmer la suppression
        </h5>
        <button type="button" class="btn-close btn-close-white" (click)="fermerModalSuppression()"></button>
      </div>

      <div class="modal-body">
        <div class="text-center mb-4" *ngIf="jourFerieASupprimer">
          <div class="danger-icon mb-3">
            <i class="bi bi-trash3-fill text-danger" style="font-size: 3rem;"></i>
          </div>

          <h6 class="fw-bold">Êtes-vous sûr de vouloir supprimer ce jour férié ?</h6>

          <!-- Informations du jour férié -->
          <div class="card border-0 bg-light mt-3">
            <div class="card-body py-2">
              <div class="d-flex justify-content-between align-items-center mb-2">
                <span class="text-muted">Nom :</span>
                <span class="fw-medium">{{ jourFerieASupprimer.nom }}</span>
              </div>
              <div class="d-flex justify-content-between align-items-center mb-2">
                <span class="text-muted">Date :</span>
                <span class="fw-medium">{{ formatDateShort(jourFerieASupprimer.dateFerie) }}</span>
              </div>
              <div class="d-flex justify-content-between align-items-center">
                <span class="text-muted">Statut :</span>
                <span [class]="getStatusBadgeClass(jourFerieASupprimer.estChomeEtPaye)">
                  {{ getStatusText(jourFerieASupprimer.estChomeEtPaye) }}
                </span>
              </div>
            </div>
          </div>

          <!-- Avertissement pour les jours futurs -->
          <div class="alert alert-warning mt-3" *ngIf="isDateInFuture(jourFerieASupprimer.dateFerie)">
            <i class="bi bi-exclamation-triangle me-2"></i>
            <small>
              <strong>Attention :</strong> Ce jour férié est prévu dans le futur et pourrait déjà être pris en compte dans les plannings.
            </small>
          </div>
        </div>

        <p class="text-muted text-center">
          Cette action est <strong>irréversible</strong>. Le jour férié sera définitivement supprimé.
        </p>
      </div>

      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" (click)="fermerModalSuppression()">
          <i class="bi bi-x-circle me-1"></i>
          Annuler
        </button>
        <button
          type="button"
          class="btn btn-danger"
          (click)="confirmerSuppression()"
          [disabled]="isDeleting">
          <span *ngIf="isDeleting" class="spinner-border spinner-border-sm me-2" role="status"></span>
          <i *ngIf="!isDeleting" class="bi bi-trash3 me-1"></i>
          <span *ngIf="isDeleting">Suppression...</span>
          <span *ngIf="!isDeleting">Supprimer définitivement</span>
        </button>
      </div>
    </div>
  </div>
</div>

<!-- Backdrop -->
<div class="modal-backdrop fade" [class.show]="showModal" *ngIf="showModal" (click)="fermerModal()"></div>
<div class="modal-backdrop fade" [class.show]="showDeleteModal" *ngIf="showDeleteModal" (click)="fermerModalSuppression()"></div>



