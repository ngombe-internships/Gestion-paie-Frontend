<div class="types-conges-container">
  <!-- En-tête -->
  <div class="page-header mb-4">
  <!-- Utilisation de flex-column pour empiler verticalement et text-center pour centrer -->
  <div class="d-flex flex-column">
    <!-- Centrer le contenu du texte -->
    <div class="text-center mb-3">
      <h2 class="page-title">
        <i class="bi bi-gear-fill me-2 text-primary"></i>
        Configuration des Types de Congés
      </h2>
      <p class="page-subtitle text-muted mb-0">
        Gérez les paramètres des différents types de congés pour votre entreprise
      </p>
    </div>
    <!-- Aligner les boutons à droite -->
    <div class="d-flex justify-content-end gap-2">
      <button
        class="btn btn-outline-primary"
        (click)="refresh()"
        [disabled]="isLoading">
        <i class="bi bi-arrow-clockwise me-1"></i>
        Actualiser
      </button>
      <button
        class="btn btn-success"
        data-bs-toggle="modal"
        data-bs-target="#modalInitialisation"
        [disabled]="isLoading">
        <i class="bi bi-plus-square me-1"></i>
        Initialiser par défaut
      </button>
    </div>
  </div>
</div>

  <!-- Statistiques -->
  <div class="row g-3 mb-4">
    <div class="col-md-3">
      <div class="card border-primary">
        <div class="card-body text-center bg-primary bg-opacity-10">
          <h3 class="card-title mb-1 text-primary fw-bold">{{ statsTotal }}</h3>
          <p class="card-text text-primary mb-0 fw-medium">Total</p>
        </div>
      </div>
    </div>

    <div class="col-md-3">
      <div class="card border-success">
        <div class="card-body text-center bg-success bg-opacity-10">
          <h3 class="card-title mb-1 text-success fw-bold">{{ statsActifs }}</h3>
          <p class="card-text text-success mb-0 fw-medium">Actifs</p>
        </div>
      </div>
    </div>

    <div class="col-md-3">
      <div class="card border-danger">
        <div class="card-body text-center bg-danger bg-opacity-10">
          <h3 class="card-title mb-1 text-danger fw-bold">{{ statsInactifs }}</h3>
          <p class="card-text text-danger mb-0 fw-medium">Inactifs</p>
        </div>
      </div>
    </div>

    <div class="col-md-3">
      <div class="card border-warning">
        <div class="card-body text-center bg-warning bg-opacity-10">
          <h3 class="card-title mb-1 text-warning fw-bold">{{ statsNonConfigures }}</h3>
          <p class="card-text text-warning mb-0 fw-medium">Non configurés</p>
        </div>
      </div>
    </div>
  </div>

  <!-- Alert types non configurés -->
  <div class="alert alert-warning" *ngIf="statsNonConfigures > 0">
    <div class="d-flex align-items-center">
      <i class="bi bi-exclamation-triangle-fill me-3 fs-4"></i>
      <div class="flex-grow-1">
        <h6 class="alert-heading mb-1">Types de congés non configurés</h6>
        <p class="mb-2">
          {{ statsNonConfigures }} type(s) de congé n'ont pas encore été configurés :
          <strong>{{ typesNonConfiguresLabels }}</strong>
        </p>
        <!-- ✅ BOUTON CORRIGÉ POUR MODAL -->
        <button
          class="btn btn-outline-warning btn-sm"
          data-bs-toggle="modal"
          data-bs-target="#modalInitialisation">
          <i class="bi bi-plus-square me-1"></i>
          Initialiser maintenant
        </button>
      </div>
    </div>
  </div>

  <!-- Filtres -->
  <div class="card shadow-sm mb-4">
    <div class="card-header bg-light">
      <h6 class="card-title mb-0">
        <i class="bi bi-funnel me-2"></i>
        Filtres et recherche
        <span class="badge bg-primary ms-2" *ngIf="getTotalPages() > 0">
          {{ totalItems }} configuration{{ totalItems > 1 ? 's' : '' }}
        </span>
      </h6>
    </div>
    <div class="card-body">
      <div class="row g-3">

        <!-- Recherche -->
        <div class="col-md-4">
          <label class="form-label fw-medium">
            <i class="bi bi-search me-1"></i>
            Rechercher
          </label>
          <div class="input-group">
            <span class="input-group-text bg-white border-end-0">
              <i class="bi bi-search text-muted"></i>
            </span>
            <input
              type="text"
              class="form-control border-start-0"
              placeholder="Type, conditions, documents..."
              [(ngModel)]="searchTerm"
              (input)="applyFilters()" />
            <button
              class="btn btn-outline-secondary"
              type="button"
              *ngIf="searchTerm"
              (click)="searchTerm = ''; applyFilters()">
              <i class="bi bi-x"></i>
            </button>
          </div>
        </div>

        <!-- Filtre statut -->
        <div class="col-md-2">
          <label class="form-label fw-medium">
            <i class="bi bi-toggle-on me-1"></i>
            Statut
          </label>
          <select class="form-select" [(ngModel)]="filterStatut" (change)="applyFilters()">
            <option value="tous">Tous</option>
            <option value="actifs">Actifs ({{ statsActifs }})</option>
            <option value="inactifs">Inactifs ({{ statsInactifs }})</option>
          </select>
        </div>

        <!-- Filtre type -->
        <div class="col-md-3">
          <label class="form-label fw-medium">
            <i class="bi bi-tag me-1"></i>
            Type de congé
          </label>
          <select class="form-select" [(ngModel)]="filterType" (change)="applyFilters()">
            <option value="tous">Tous les types</option>
            <option *ngFor="let type of typesCongeDisponibles" [value]="type.value">
              {{ type.label }}
            </option>
          </select>
        </div>

        <!-- Items par page -->
        <div class="col-md-2">
          <label class="form-label fw-medium">Affichage</label>
          <select class="form-select" [(ngModel)]="itemsPerPage" (change)="applyFilters()">
            <option value="5">5 par page</option>
            <option value="10">10 par page</option>
            <option value="25">25 par page</option>
          </select>
        </div>

        <!-- Reset -->
        <div class="col-md-2 d-flex align-items-end">
          <button class="btn btn-outline-secondary w-100" (click)="resetFilters()" title="Réinitialiser les filtres">
            <i class="bi bi-arrow-counterclockwise"></i>Réinitialiser
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- Tableau -->
  <div class="card shadow-sm">
    <div class="card-header bg-white">
      <h6 class="card-title mb-0">
        <i class="bi bi-table me-2"></i>
        Configurations des types de congés
      </h6>
    </div>

    <div class="card-body p-0">
      <!-- État de chargement -->
      <div *ngIf="isLoading" class="loading-container py-5">
        <div class="loading-content text-center">
          <div class="spinner-border text-primary mb-3" role="status">
            <span class="visually-hidden">Chargement...</span>
          </div>
          <p class="text-muted">Chargement des configurations...</p>
        </div>
      </div>

      <!-- État d'erreur -->
      <div *ngIf="error && !isLoading" class="alert alert-danger m-3" role="alert">
        <div class="d-flex align-items-center">
          <i class="bi bi-exclamation-triangle-fill me-2 fs-4"></i>
          <div class="flex-grow-1">
            <h6 class="alert-heading mb-1">Erreur de chargement</h6>
            <p class="mb-2">{{ error }}</p>
            <button class="btn btn-outline-danger btn-sm" (click)="refresh()">
              <i class="bi bi-arrow-clockwise me-1"></i>
              Réessayer
            </button>
          </div>
        </div>
      </div>

      <!-- Tableau des données -->
      <div *ngIf="!isLoading && !error" class="table-responsive">
        <table class="table table-hover align-middle mb-0">
          <thead class="table-light sticky-top">
            <tr>
              <!-- Type de congé -->
              <th scope="col" class="border-0 ps-3 sortable" (click)="sort('typeConge')">
                <div class="d-flex align-items-center">
                  <i class="bi bi-tag me-2 text-primary"></i>
                  Type de congé
                  <i class="bi ms-1" [ngClass]="{
                    'bi-arrow-up': sortBy === 'typeConge' && sortDirection === 'asc',
                    'bi-arrow-down': sortBy === 'typeConge' && sortDirection === 'desc',
                    'bi-arrow-up-down': sortBy !== 'typeConge'
                  }"></i>
                </div>
              </th>

              <!-- Durée -->
              <th scope="col" class="border-0 text-center sortable" (click)="sort('dureeMaximaleJours')">
                <div class="d-flex align-items-center justify-content-center">
                  <i class="bi bi-calendar-range me-1 text-primary"></i>
                  Durée max
                  <i class="bi ms-1" [ngClass]="{
                    'bi-arrow-up': sortBy === 'dureeMaximaleJours' && sortDirection === 'asc',
                    'bi-arrow-down': sortBy === 'dureeMaximaleJours' && sortDirection === 'desc',
                    'bi-arrow-up-down': sortBy !== 'dureeMaximaleJours'
                  }"></i>
                </div>
              </th>

              <!-- Préavis -->
              <th scope="col" class="border-0 text-center sortable" (click)="sort('delaiPreavisJours')">
                <div class="d-flex align-items-center justify-content-center">
                  <i class="bi bi-clock me-1 text-primary"></i>
                  Préavis
                  <i class="bi ms-1" [ngClass]="{
                    'bi-arrow-up': sortBy === 'delaiPreavisJours' && sortDirection === 'asc',
                    'bi-arrow-down': sortBy === 'delaiPreavisJours' && sortDirection === 'desc',
                    'bi-arrow-up-down': sortBy !== 'delaiPreavisJours'
                  }"></i>
                </div>
              </th>

              <!-- Rémunération -->
              <th scope="col" class="border-0 text-center sortable" (click)="sort('pourcentageRemuneration')">
                <div class="d-flex align-items-center justify-content-center">
                  <i class="bi bi-percent me-1 text-primary"></i>
                  Rémunération
                  <i class="bi ms-1" [ngClass]="{
                    'bi-arrow-up': sortBy === 'pourcentageRemuneration' && sortDirection === 'asc',
                    'bi-arrow-down': sortBy === 'pourcentageRemuneration' && sortDirection === 'desc',
                    'bi-arrow-up-down': sortBy !== 'pourcentageRemuneration'
                  }"></i>
                </div>
              </th>

              <!-- Documents -->
              <th scope="col" class="border-0 text-center">
                <i class="bi bi-file-earmark-text me-1 text-primary"></i>
                Documents
              </th>

              <!-- Statut -->
              <th scope="col" class="border-0 text-center sortable" (click)="sort('actif')">
                <div class="d-flex align-items-center justify-content-center">
                  <i class="bi bi-toggle-on me-1 text-primary"></i>
                  Statut
                  <i class="bi ms-1" [ngClass]="{
                    'bi-arrow-up': sortBy === 'actif' && sortDirection === 'asc',
                    'bi-arrow-down': sortBy === 'actif' && sortDirection === 'desc',
                    'bi-arrow-up-down': sortBy !== 'actif'
                  }"></i>
                </div>
              </th>

              <!-- Actions -->
              <th scope="col" class="border-0 text-center pe-3">
                <i class="bi bi-gear me-1"></i>
                Actions
              </th>
            </tr>
          </thead>

          <tbody>
            <tr *ngFor="let config of getPaginatedItems(); let i = index" class="table-row">

              <!-- Type de congé -->
              <td class="ps-3">
                <div class="type-conge-info">
                  <div class="fw-bold text-primary">{{ getTypeCongeLabel(config.typeConge) }}</div>
                  <small class="text-muted">{{ config.typeConge }}</small>
                  <div class="mt-1" *ngIf="config.conditionsAttribution">
                    <small class="text-info">
                      <i class="bi bi-info-circle me-1"></i>
                      {{ config.conditionsAttribution }}
                    </small>
                  </div>
                </div>
              </td>

              <!-- Durée maximale -->
              <td class="text-center">
                <div class="duration-badge">
                  <span class="badge bg-info text-dark fs-6">
                    {{ config.dureeMaximaleJours }}
                    {{ config.dureeMaximaleJours === 1 ? 'jour' : 'jours' }}
                  </span>
                </div>
              </td>

              <!-- Délai de préavis -->
              <td class="text-center">
                <div class="preavis-badge">
                  <span class="badge" [class]="config.delaiPreavisJours === 0 ? 'bg-success' : 'bg-warning text-dark'">
                    {{ config.delaiPreavisJours === 0 ? 'Aucun' : config.delaiPreavisJours + ' jour' + (config.delaiPreavisJours > 1 ? 's' : '') }}
                  </span>
                </div>
              </td>

              <!-- Pourcentage rémunération -->
              <td class="text-center">
                <div class="remuneration-info">
                  <span class="fw-bold" [class]="getPercentageColor(config.pourcentageRemuneration)">
                    {{ config.pourcentageRemuneration }}%
                  </span>
                  <div class="progress mt-1" style="height: 4px;">
                    <div class="progress-bar"
                         [class]="config.pourcentageRemuneration >= 100 ? 'bg-success' : config.pourcentageRemuneration >= 50 ? 'bg-warning' : 'bg-danger'"
                         [style.width.%]="config.pourcentageRemuneration">
                    </div>
                  </div>
                </div>
              </td>

              <!-- Documents requis -->
              <td class="text-center">
                <div class="documents-info" *ngIf="config.documentsRequis && config.documentsRequis.trim()">
                  <div class="dropdown">
                    <button class="btn btn-sm btn-outline-secondary dropdown-toggle"
                            type="button"
                            data-bs-toggle="dropdown">
                      <i class="bi bi-file-earmark-text me-1"></i>
                      {{ getDocumentsRequisList(config.documentsRequis).length }} doc{{ getDocumentsRequisList(config.documentsRequis).length > 1 ? 's' : '' }}
                    </button>
                    <ul class="dropdown-menu">
                      <li *ngFor="let doc of getDocumentsRequisList(config.documentsRequis)">
                        <span class="dropdown-item-text">
                          <i class="bi bi-file-earmark me-2"></i>
                          {{ formatDocumentRequis(doc) }}
                        </span>
                      </li>
                    </ul>
                  </div>
                  <div class="mt-1" *ngIf="config.documentsObligatoires">
                    <small class="badge bg-danger">Obligatoires</small>
                  </div>
                </div>
                <span class="text-muted" *ngIf="!config.documentsRequis || !config.documentsRequis.trim()">
                  <i class="bi bi-dash"></i>
                  Aucun
                </span>
              </td>

              <!-- Statut -->
              <td class="text-center">
                <span [class]="getStatutBadgeClass(config.actif)">
                  <i class="bi me-1" [ngClass]="getStatutIcon(config.actif)"></i>
                  {{ getStatutText(config.actif) }}
                </span>
                <div class="mt-1" *ngIf="config.cumulAutorise">
                  <small class="badge bg-info">Cumul autorisé</small>
                </div>
              </td>

              <!-- ✅ ACTIONS CORRIGÉES -->
              <td class="text-center pe-3">
                <div class="btn-group action-buttons" role="group">
                  <button
                    class="btn btn-outline-primary btn-sm"
                    (click)="ouvrirModalModification(config)"
                    title="Modifier la configuration">
                    <i class="bi bi-pencil me-1"></i>
                    Modifier
                  </button>
                  <!-- ✅ BOUTON CORRIGÉ POUR MODAL DE TOGGLE -->
                  <button
                    class="btn btn-sm"
                    [class]="config.actif ? 'btn-outline-danger' : 'btn-outline-success'"
                    (click)="ouvrirModalToggleStatus(config)"
                    [title]="config.actif ? 'Désactiver' : 'Activer'">
                    <i class="bi me-1" [ngClass]="config.actif ? 'bi-toggle-off' : 'bi-toggle-on'"></i>
                    {{ config.actif ? 'Désactiver' : 'Activer' }}
                  </button>
                </div>
              </td>
            </tr>

            <!-- Aucun résultat -->
            <tr *ngIf="getPaginatedItems().length === 0">
              <td colspan="7" class="text-center py-5">
                <div class="empty-state">
                  <i class="bi bi-gear-wide empty-icon text-muted mb-3" style="font-size: 4rem;"></i>
                  <h6 class="empty-title">Aucune configuration trouvée</h6>
                  <p class="empty-description text-muted">
                    {{ searchTerm || filterStatut !== 'tous' || filterType !== 'tous'
                       ? 'Aucune configuration ne correspond aux critères de recherche.'
                       : 'Aucune configuration de type de congé n\'est disponible.' }}
                  </p>
                  <div class="mt-3">
                    <button class="btn btn-primary btn-sm me-2" (click)="resetFilters()" *ngIf="searchTerm || filterStatut !== 'tous' || filterType !== 'tous'">
                      <i class="bi bi-arrow-counterclockwise me-1"></i>
                      Réinitialiser les filtres
                    </button>
                    <button
                      class="btn btn-success btn-sm"
                      data-bs-toggle="modal"
                      data-bs-target="#modalInitialisation"
                      *ngIf="statsTotal === 0">
                      <i class="bi bi-plus-square me-1"></i>
                      Initialiser les configurations
                    </button>
                  </div>
                </div>
              </td>
            </tr>
          </tbody>
        </table>
      </div>

      <!-- Pagination -->
      <div class="card-footer bg-white" *ngIf="getTotalPages() > 1">
        <div class="d-flex justify-content-between align-items-center">
          <div class="text-muted">
            <small>
              Affichage de {{ (currentPage - 1) * itemsPerPage + 1 }} à
              {{ getMin(currentPage * itemsPerPage, totalItems) }} sur {{ totalItems }} configuration(s)
            </small>
          </div>

          <nav aria-label="Navigation des pages">
            <ul class="pagination pagination-sm mb-0">
              <li class="page-item" [class.disabled]="currentPage === 1">
                <button class="page-link" (click)="goToPage(currentPage - 1)">
                  <i class="bi bi-chevron-left"></i>
                </button>
              </li>

              <li class="page-item"
                  *ngFor="let page of [].constructor(getTotalPages()); let i = index"
                  [class.active]="currentPage === i + 1">
                <button class="page-link" (click)="goToPage(i + 1)">
                  {{ i + 1 }}
                </button>
              </li>

              <li class="page-item" [class.disabled]="currentPage === getTotalPages()">
                <button class="page-link" (click)="goToPage(currentPage + 1)">
                  <i class="bi bi-chevron-right"></i>
                </button>
              </li>
            </ul>
          </nav>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- ✅ MODAL D'INITIALISATION CORRIGÉ -->
<div class="modal fade" id="modalInitialisation" tabindex="-1" aria-labelledby="modalInitialisationLabel" aria-hidden="true" #modalInitialisation>
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content">
      <div class="modal-header bg-success text-white">
        <h5 class="modal-title" id="modalInitialisationLabel">
          <i class="bi bi-gear-fill me-2"></i>
          Initialisation des configurations
        </h5>
        <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>

      <div class="modal-body">
        <div class="d-flex align-items-start">
          <div class="flex-shrink-0">
            <div class="rounded-circle bg-warning bg-opacity-20 p-3">
              <i class="bi bi-exclamation-triangle text-warning fs-4"></i>
            </div>
          </div>
          <div class="flex-grow-1 ms-3">
            <h6 class="mb-2">Êtes-vous sûr de vouloir initialiser les configurations par défaut ?</h6>
            <p class="text-muted mb-3">
              Cette action va créer les configurations standard pour tous les types de congés disponibles.
            </p>

            <!-- Liste des types qui seront créés -->
            <div class="alert alert-info" *ngIf="getTypesNonConfigures().length > 0">
              <small class="fw-bold">Types de congés qui seront configurés :</small>
              <ul class="mb-0 mt-2 small">
                <li *ngFor="let type of getTypesNonConfigures()">
                  {{ type.label }}
                </li>
              </ul>
            </div>

            <div class="alert alert-warning" *ngIf="getTypesNonConfigures().length === 0">
              <small>
                <i class="bi bi-info-circle me-1"></i>
                Toutes les configurations sont déjà créées. Cette action n'aura aucun effet.
              </small>
            </div>
          </div>
        </div>
      </div>

      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
          <i class="bi bi-x-circle me-1"></i>
          Annuler
        </button>
        <button
          type="button"
          class="btn btn-success"
          (click)="confirmerInitialisation()"
          [disabled]="isInitializing">
          <span *ngIf="isInitializing" class="spinner-border spinner-border-sm me-2" role="status"></span>
          <i *ngIf="!isInitializing" class="bi bi-check-circle me-1"></i>
          {{ isInitializing ? 'Initialisation...' : 'Confirmer l\'initialisation' }}
        </button>
      </div>
    </div>
  </div>
</div>

<!-- ✅ NOUVEAU MODAL DE TOGGLE STATUS -->
<div class="modal fade" [class.show]="showToggleModal" [style.display]="showToggleModal ? 'block' : 'none'"
     tabindex="-1" *ngIf="showToggleModal" #modalToggleStatus>
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content">
      <div class="modal-header" [class]="configToToggle?.actif ? 'bg-danger text-white' : 'bg-success text-white'">
        <h5 class="modal-title">
          <i class="bi" [ngClass]="configToToggle?.actif ? 'bi-toggle-off' : 'bi-toggle-on'" class="me-2"></i>
          {{ configToToggle?.actif ? 'Désactiver' : 'Activer' }} la configuration
        </h5>
        <button type="button" class="btn-close" [class]="configToToggle?.actif ? 'btn-close-white' : 'btn-close-white'" (click)="fermerModalToggleStatus()"></button>
      </div>

      <div class="modal-body">
        <div class="d-flex align-items-start">
          <div class="flex-shrink-0">
            <div class="rounded-circle p-3" [class]="configToToggle?.actif ? 'bg-danger bg-opacity-20' : 'bg-success bg-opacity-20'">
              <i class="bi fs-4" [ngClass]="configToToggle?.actif ? 'bi-exclamation-triangle text-danger' : 'bi-check-circle text-success'"></i>
            </div>
          </div>
          <div class="flex-grow-1 ms-3">
            <h6 class="mb-2">
              Êtes-vous sûr de vouloir {{ configToToggle?.actif ? 'désactiver' : 'activer' }}
              la configuration "{{ configToToggle ? getTypeCongeLabel(configToToggle.typeConge) : '' }}" ?
            </h6>

            <div class="alert" [class]="configToToggle?.actif ? 'alert-warning' : 'alert-info'">
              <small>
                <i class="bi me-1" [ngClass]="configToToggle?.actif ? 'bi-exclamation-triangle' : 'bi-info-circle'"></i>
                <strong>{{ configToToggle?.actif ? 'Attention :' : 'Information :' }}</strong>
                {{ configToToggle?.actif
                   ? 'Les employés ne pourront plus faire de demandes pour ce type de congé.'
                   : 'Les employés pourront à nouveau faire des demandes pour ce type de congé.' }}
              </small>
            </div>

            <!-- Informations de la configuration -->
            <div class="mt-3" *ngIf="configToToggle">
              <small class="text-muted">
                <strong>Configuration actuelle :</strong><br>
                • Durée maximale : {{ configToToggle.dureeMaximaleJours }} jour(s)<br>
                • Délai de préavis : {{ configToToggle.delaiPreavisJours }} jour(s)<br>
                • Rémunération : {{ configToToggle.pourcentageRemuneration }}%
              </small>
            </div>
          </div>
        </div>
      </div>

      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" (click)="fermerModalToggleStatus()">
          <i class="bi bi-x-circle me-1"></i>
          Annuler
        </button>
        <button
          type="button"
          class="btn"
          [class]="configToToggle?.actif ? 'btn-danger' : 'btn-success'"
          (click)="confirmerToggleStatus()"
          [disabled]="isToggling">
          <span *ngIf="isToggling" class="spinner-border spinner-border-sm me-2" role="status"></span>
          <i *ngIf="!isToggling" class="bi me-1" [ngClass]="configToToggle?.actif ? 'bi-toggle-off' : 'bi-toggle-on'"></i>
          <span *ngIf="isToggling">{{ configToToggle?.actif ? 'Désactivation...' : 'Activation...' }}</span>
          <span *ngIf="!isToggling">{{ configToToggle?.actif ? 'Confirmer la désactivation' : 'Confirmer l\'activation' }}</span>
        </button>
      </div>
    </div>
  </div>
</div>

<!-- Modal de modification -->
<div class="modal fade" [class.show]="showModal" [style.display]="showModal ? 'block' : 'none'"
     tabindex="-1" *ngIf="showModal">
  <div class="modal-dialog modal-lg">
    <div class="modal-content">
      <div class="modal-header bg-primary text-white">
        <h5 class="modal-title">
          <i class="bi bi-gear-fill me-2"></i>
          Configuration : {{ selectedConfig ? getTypeCongeLabel(selectedConfig.typeConge) : '' }}
        </h5>
        <button type="button" class="btn-close btn-close-white" (click)="fermerModal()"></button>
      </div>

      <form [formGroup]="configForm" (ngSubmit)="onSubmit()">
        <div class="modal-body">

          <!-- Informations générales -->
          <div class="row mb-4">
            <div class="col-12">
              <h6 class="text-primary border-bottom pb-2 mb-3">
                <i class="bi bi-info-circle me-2"></i>
                Paramètres généraux
              </h6>
            </div>

            <!-- Durée maximale -->
            <div class="col-md-6 mb-3">
              <label for="dureeMaximaleJours" class="form-label">
                <i class="bi bi-calendar-range text-primary me-1"></i>
                Durée maximale <span class="text-danger">*</span>
              </label>
              <div class="input-group">
                <input
                  type="number"
                  id="dureeMaximaleJours"
                  class="form-control"
                  formControlName="dureeMaximaleJours"
                  [class.is-invalid]="isFieldInvalid('dureeMaximaleJours')"
                  min="1"
                  max="365"
                  placeholder="Nombre de jours">
                <span class="input-group-text">jour(s)</span>
              </div>
              <div class="invalid-feedback" *ngIf="isFieldInvalid('dureeMaximaleJours')">
                {{ getFieldError('dureeMaximaleJours') }}
              </div>
            </div>

            <!-- Délai de préavis -->
            <div class="col-md-6 mb-3">
              <label for="delaiPreavisJours" class="form-label">
                <i class="bi bi-clock text-primary me-1"></i>
                Délai de préavis <span class="text-danger">*</span>
              </label>
              <div class="input-group">
                <input
                  type="number"
                  id="delaiPreavisJours"
                  class="form-control"
                  formControlName="delaiPreavisJours"
                  [class.is-invalid]="isFieldInvalid('delaiPreavisJours')"
                  min="0"
                  max="90"
                  placeholder="Nombre de jours">
                <span class="input-group-text">jour(s)</span>
              </div>
              <div class="invalid-feedback" *ngIf="isFieldInvalid('delaiPreavisJours')">
                {{ getFieldError('delaiPreavisJours') }}
              </div>
              <small class="form-text text-muted">0 = aucun délai de préavis requis</small>
            </div>
          </div>

          <!-- Rémunération et options -->
          <div class="row mb-4">
            <div class="col-12">
              <h6 class="text-primary border-bottom pb-2 mb-3">
                <i class="bi bi-cash-stack me-2"></i>
                Rémunération et options
              </h6>
            </div>

            <!-- Pourcentage rémunération -->
            <div class="col-md-8 mb-3">
              <label for="pourcentageRemuneration" class="form-label">
                <i class="bi bi-percent text-primary me-1"></i>
                Pourcentage de rémunération <span class="text-danger">*</span>
              </label>
              <div class="input-group">
                <input
                  type="number"
                  id="pourcentageRemuneration"
                  class="form-control"
                  formControlName="pourcentageRemuneration"
                  [class.is-invalid]="isFieldInvalid('pourcentageRemuneration')"
                  min="0"
                  max="100"
                  step="0.1"
                  placeholder="0 à 100">
                <span class="input-group-text">%</span>
              </div>
              <div class="invalid-feedback" *ngIf="isFieldInvalid('pourcentageRemuneration')">
                {{ getFieldError('pourcentageRemuneration') }}
              </div>

              <!-- Barre de progression visuelle -->
              <div class="mt-2" *ngIf="configForm.get('pourcentageRemuneration')?.value !== null">
                <div class="progress" style="height: 8px;">
                  <div class="progress-bar"
                       [class]="configForm.get('pourcentageRemuneration')?.value >= 100 ? 'bg-success' :
                               configForm.get('pourcentageRemuneration')?.value >= 50 ? 'bg-warning' : 'bg-danger'"
                       [style.width.%]="configForm.get('pourcentageRemuneration')?.value || 0">
                  </div>
                </div>
                <small class="text-muted">
                  {{ configForm.get('pourcentageRemuneration')?.value || 0 }}% du salaire de base
                </small>
              </div>
            </div>

            <!-- Options -->
            <div class="col-md-4 mb-3">
              <label class="form-label">Options</label>

              <div class="form-check">
                <input
                  class="form-check-input"
                  type="checkbox"
                  id="cumulAutorise"
                  formControlName="cumulAutorise">
                <label class="form-check-label" for="cumulAutorise">
                  <i class="bi bi-stack text-success me-1"></i>
                  Cumul autorisé
                </label>
              </div>

              <div class="form-check mt-2">
                <input
                  class="form-check-input"
                  type="checkbox"
                  id="actif"
                  formControlName="actif">
                <label class="form-check-label" for="actif">
                  <i class="bi bi-toggle-on text-primary me-1"></i>
                  Configuration active
                </label>
              </div>
            </div>
          </div>

          <!-- Documents et conditions -->
          <div class="row">
            <div class="col-12">
              <h6 class="text-primary border-bottom pb-2 mb-3">
                <i class="bi bi-file-earmark-text me-2"></i>
                Documents et conditions
              </h6>
            </div>

            <!-- Documents requis -->
            <div class="col-md-6 mb-3">
              <label for="documentsRequis" class="form-label">
                <i class="bi bi-file-earmark-text text-primary me-1"></i>
                Documents requis
              </label>
              <textarea
                id="documentsRequis"
                class="form-control"
                formControlName="documentsRequis"
                rows="4"
                placeholder="Ex: CERTIFICAT_MEDICAL, ACTE_MARIAGE&#10;Séparez par des virgules"></textarea>
              <small class="form-text text-muted">
                Documents justificatifs requis (séparés par des virgules)
              </small>
            </div>

            <!-- Conditions d'attribution -->
            <div class="col-md-6 mb-3">
              <label for="conditionsAttribution" class="form-label">
                <i class="bi bi-list-check text-primary me-1"></i>
                Conditions d'attribution
              </label>
              <textarea
                id="conditionsAttribution"
                class="form-control"
                formControlName="conditionsAttribution"
                rows="4"
                placeholder="Ex: Minimum 6 mois d'ancienneté&#10;Accord du manager requis"></textarea>
              <small class="form-text text-muted">
                Conditions spéciales pour bénéficier de ce type de congé
              </small>
            </div>
          </div>

        </div>

        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" (click)="fermerModal()">
            <i class="bi bi-x-circle me-1"></i>
            Annuler
          </button>
          <button
            type="submit"
            class="btn btn-primary"
            [disabled]="configForm.invalid || isSubmitting">
            <span *ngIf="isSubmitting" class="spinner-border spinner-border-sm me-2" role="status"></span>
            <i *ngIf="!isSubmitting" class="bi bi-check-circle me-1"></i>
            <span *ngIf="isSubmitting">Sauvegarde...</span>
            <span *ngIf="!isSubmitting">Sauvegarder</span>
          </button>
        </div>
      </form>
    </div>
  </div>
</div>

<!-- Backdrops -->
<div class="modal-backdrop fade" [class.show]="showModal" *ngIf="showModal" (click)="fermerModal()"></div>
<div class="modal-backdrop fade" [class.show]="showToggleModal" *ngIf="showToggleModal" (click)="fermerModalToggleStatus()"></div>
